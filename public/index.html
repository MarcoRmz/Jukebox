<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <title>Jukebox</title>
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jquerymobile/1.4.3/jquery.mobile.min.css" />
    <script type="text/javascript" charset="utf-8" src="js/ui.min.js"></script>
    <!-- Inicializacion de Soundcloud -->
    <script src="http://connect.soundcloud.com/sdk.js"></script>

    <!-- Lobster font -->
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>

    <!--AppFramework plugin for sliding side menu-->
    <script type="application/javascript" src="sidebar/js/jquery.event.move.js"></script>
    <script type="application/javascript" src="sidebar/js/jquery.event.swipe.js"></script>
    <script type="application/javascript" src="sidebar/js/sidebar.js"></script>
    <script type="application/javascript" src="sidebar/js/swipe.js"></script>
    <script>       
      $.ui.autoLaunch = false;
      $.ui.animateHeaders = false;

        $(document).ready(function(){

          $.ui.launch();
        });
    </script>
</head>
<body>
    <!-- ADD user_events -->
    <script src="//connect.soundcloud.com/sdk.js"></script>
    <script>
    // initialize client with app credentials
    SC.initialize({
      client_id: '67df025394fb58a59495a2b8f8573ddd',
      redirect_uri: 'http://jukebox.parseapp.com/callback.html'
    });

    // initiate auth popup
    SC.connect(function() {
      SC.get('/me', function(me) { 
        console.log('Hello, ' + me.username);
      });
    });
    </script>
    <script>
      $("#loadTracks").live("click", function(){
        var track_url = 'http://api.soundcloud.com/playlists/56490285';
        SC.oEmbed(track_url, { auto_play: true }, function(oEmbed) {
          console.log('oEmbed response: ' + oEmbed);
        });
        $('#track').append('<iframe width="100%" height="170" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/56490285&amp;color=00aabb&amp;auto_play=true&amp;hide_related=true&amp;show_comments=false&amp;show_user=false&amp;show_reposts=true"></iframe>');
        SC.get('/playlists/56490285', function(playlist) {
          for (var i = 0; i < playlist.tracks.length; i++) {
            $('#results').append($('<li></li>').html(playlist.tracks[i].title));
          }
        });
      });
    </script>

    <script>
      $("#searchTracks").live("click", function(){
        // find tracks
        SC.get('/tracks', { q: 'buskers' }, function(tracks) {
          console.log(tracks);
        });
      });
    </script>

    <script>
          var Parse = require('parse-1.2.8.js');
          // This is called with the results from from FB.getLoginStatus().
          function statusChangeCallback(response) {
            console.log('statusChangeCallback');
            console.log(response);
            // The response object is returned with a status field that lets the
            // app know the current login status of the person.
            // Full docs on the response object can be found in the documentation
            // for FB.getLoginStatus().
            if (response.status === 'connected') {
              // Logged into your app and Facebook.
              
              loadEventsAPI();
          } else if (response.status === 'not_authorized') {
              // The person is logged into Facebook, but not your app.
              document.getElementById('status').innerHTML = 'Please log ' +
              'into this app.';
          } else {
              // The person is not logged into Facebook, so we're not sure if
              // they are logged into this app or not.
              document.getElementById('status').innerHTML = 'Please log ' +
              'into Facebook.';
          }
        }

          // This function is called when someone finishes with the Login
          // Button.  See the onlogin handler attached to it in the sample
          // code below.
          function checkLoginState() {
            FB.getLoginStatus(function(response) {
              statusChangeCallback(response);
          });
        }

          // Initialize Parse
          Parse.initialize("GTjpoxopLzGRl22uQERqDTZkFwhjWZjlvWKNP6xI", "q5HJWi04jWKkLuCXu9ywWCn2ZUextNxQugJTK1qK");

          window.fbAsyncInit = function() {
            Parse.FacebookUtils.init({ // this line replaces FB.init({
              appId      : '1556411531239729', // Facebook App ID
              status     : true, // check Facebook Login status
              cookie     : true, // enable cookies to allow Parse to access the session
              xfbml      : true
          });

            // Run code after the Facebook SDK is loaded.
            };

            (function(d, s, id){
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) {return;}
                js = d.createElement(s); js.id = id;
                js.src = "https://connect.facebook.net/en_US/sdk.js";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));

          // Here we run a very simple test of the Graph API after login is
          // successful.  See statusChangeCallback() for when this call is made.
          function loadEventsAPI() {
            console.log('Welcome!  Fetching your information.... ');
            alert("works");
            FB.api('/me/events', function(response) {
                if (response && !response.error) {
                  alert("works");
                }
            });
          }

        Parse.FacebookUtils.logIn("publish_actions, user_events, email",{
          success: function(user) {
            if (!user.existed()) {
              alert("User signed up and logged in through Facebook!");
            } else {
              alert("User logged in through Facebook!");
            }
          },
          error: function(user, error) {
            alert("User cancelled the Facebook login or did not fully authorize.");
          }
        });
    </script>
    
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript">
        app.initialize();
    </script>


    <!--html y css-->

    <div id="wrapper">
      <p class="title_name">Jukebox</p>

      <!--Left Side Menu Navigation bar -->
      <nav id="sidebar">
        <ul class="list">
          <li id="opciones"><a href="#page1" style="text-align: center;"><span class="icon-remote"></span><p style="text-align: center;">Home</p></a></li>
          <li id="opciones"><a href="#page2" style="text-align: center;"><span class="icon-music"></span><p style="text-align: center;">Now Playing</p></a></li>
          <li id="opciones"><a href="#page3" style="text-align: center;"><span class="icon-cast"></span><p style="text-align: center;">Queue</p></a></li>
          <li id="opciones"><a href="#page4" style="text-align: center;"><span class="icon-cast"></span><p style="text-align: center;">Search</p></a></li>
          <br>
          <div id="fb-root">
          </div>
          <script>(function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&appId=1556411531239729&version=v2.1";
            fjs.parentNode.insertBefore(js, fjs);
          }(document, 'script', 'facebook-jssdk'));</script>

          <div
          class="fb-login-button"
          data-show-faces="false"
          data-auto-logout-link="true"
          onlogin="checkLoginState();"
          data-width="400"
          data-max-rows="1"
          data-scope="publish_actions, email, user_events">
          </div>
      </ul>
    </nav>
  </div>

    <div id="content">
    <!--Main View Pages-->
      <div class="panel" title="Home" id="page1" data-footer="none" selected="true">
          <header>
              <a id="menubadge" onclick='$.ui.toggleSideMenu()' class='menuButton' style="float:left !important"></a>
          </header>
          <div id="page">
            <h1>Home</h1>
          </div>
      </div>
      
      <div class="panel" title="Now Playing" id="page2" data-footer="none" selected="true">
          <header>
              <a id="menubadge" onclick='$.ui.toggleSideMenu()' class='menuButton' style="float:left !important"></a>
          </header>
          <div id="page">
            <input type="button" id="loadTracks" class="button big" value="Get hottest track" />
            <ul id="results">

            </ul>
            <div id="track"></div>
          </div>
      </div>

      <div class="panel" title="Queue" id="page3" data-footer="none" selected="true">
          <header>
              <a id="menubadge" onclick='$.ui.toggleSideMenu()' class='menuButton' style="float:left !important"></a>
          </header>
          <div id="page">
            <h1>Queue</h1>
          </div>
      </div>

      <div class="panel" title="Search" id="page4" data-footer="none" selected="true">
          <header>
              <a id="menubadge" onclick='$.ui.toggleSideMenu()' class='menuButton' style="float:left !important"></a>
          </header>
          <div id="page">
            <h1>Search</h1>
          </div>
      </div>
    </div>
  </div>
</body>
</html>
